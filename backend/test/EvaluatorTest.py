from utils.llm_initial_util import initialize_llm
import models.state as state
import agent.evaluator as evaluator

detector_result = [
    {"case_ID": "1", "function": "账号登录", "testPoint": "账号输入框显示清空按钮功能"},
    {"case_ID": "2", "function": "账号登录", "testPoint": "密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "3", "function": "账号登录", "testPoint": "验证码为4位随机大写英文字母"},
    {"case_ID": "4", "function": "账号登录", "testPoint": "单击验证码展示区域刷新验证码"},
    {"case_ID": "5", "function": "账号登录", "testPoint": "验证码有效期60秒"},
    {"case_ID": "6", "function": "账号登录", "testPoint": "输入框获取焦点提示文字消失且边框变绿"},
    {"case_ID": "7", "function": "账号登录", "testPoint": "输入框失去焦点恢复原状"},
    {"case_ID": "8", "function": "账号登录", "testPoint": "点击【登录】按钮依次校验账号、密码、验证码"},
    {"case_ID": "9", "function": "账号登录", "testPoint": "某一项校验出错在对应输入框下方红字提醒"},
    {"case_ID": "10", "function": "账号登录", "testPoint": "全部校验通过成功登录并进入系统首页"},
    {"case_ID": "11", "function": "账号登录", "testPoint": "点击【找回密码】按钮跳转至找回密码页面"},
    {"case_ID": "12", "function": "账号登录", "testPoint": "账号首次成功登录弹窗提示修改初始密码"},
    {"case_ID": "13", "function": "账号登录", "testPoint": "点击【确定】按钮跳转至修改初始密码页面"},
    {"case_ID": "14", "function": "账号登录", "testPoint": "初始密码修改后需重新输入账号、密码、验证码登录"},
    {"case_ID": "15", "function": "重置初始密码", "testPoint": "新密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "16", "function": "重置初始密码", "testPoint": "确认密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "17", "function": "重置初始密码", "testPoint": "点击【获取验证码】按钮发送6位随机数字验证码"},
    {"case_ID": "18", "function": "重置初始密码", "testPoint": "验证码已发送后【获取验证码】按钮展示60秒倒计时"},
    {"case_ID": "19", "function": "重置初始密码", "testPoint": "验证码有效期60秒"},
    {"case_ID": "20", "function": "重置初始密码", "testPoint": "输入框获取焦点提示文字消失且输入框边框变绿"},
    {"case_ID": "21", "function": "重置初始密码", "testPoint": "输入框失去焦点恢复原状"},
    {"case_ID": "22", "function": "重置初始密码", "testPoint": "点击【取消】按钮取消修改初始密码返回登录页面"},
    {"case_ID": "23", "function": "重置初始密码", "testPoint": "点击【提交】按钮依次校验密码、验证码"},
    {"case_ID": "24", "function": "重置初始密码", "testPoint": "某一项校验出错在对应输入框下方红字提醒"},
    {"case_ID": "25", "function": "重置初始密码", "testPoint": "全部校验通过提示重置密码成功返回登录页面"},
    {"case_ID": "26", "function": "找回密码", "testPoint": "新密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "27", "function": "找回密码", "testPoint": "确认密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "28", "function": "找回密码", "testPoint": "点击【获取验证码】按钮发送6位随机数字验证码"},
    {"case_ID": "29", "function": "找回密码", "testPoint": "验证码已发送后【获取验证码】按钮展示60秒倒计时"},
    {"case_ID": "30", "function": "找回密码", "testPoint": "验证码有效期60秒"},
    {"case_ID": "31", "function": "找回密码", "testPoint": "输入框获取焦点提示文字消失且输入框边框变绿"},
    {"case_ID": "32", "function": "找回密码", "testPoint": "输入框失去焦点恢复原状"},
    {"case_ID": "33", "function": "找回密码", "testPoint": "点击【取消】按钮取消修改初始密码返回登录页面"},
    {"case_ID": "34", "function": "找回密码", "testPoint": "点击【提交】按钮依次校验密码、验证码"},
    {"case_ID": "35", "function": "找回密码", "testPoint": "某一项校验出错在对应输入框下方红字提醒"},
    {"case_ID": "36", "function": "找回密码", "testPoint": "全部校验通过提示重置密码成功返回登录页面"},
    {"case_ID": "37", "function": "修改密码", "testPoint": "原密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "38", "function": "修改密码", "testPoint": "新密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "39", "function": "修改密码", "testPoint": "确认密码输入框显示明文查看按钮及清空按钮功能"},
    {"case_ID": "40", "function": "修改密码", "testPoint": "点击【获取验证码】按钮发送6位随机数字验证码"},
    {"case_ID": "41", "function": "修改密码", "testPoint": "验证码已发送后【获取验证码】按钮展示60秒倒计时"},
    {"case_ID": "42", "function": "修改密码", "testPoint": "验证码有效期60秒"},
    {"case_ID": "43", "function": "修改密码", "testPoint": "输入框获取焦点提示文字消失且输入框边框变绿"},
    {"case_ID": "44", "function": "修改密码", "testPoint": "输入框失去焦点恢复原状"},
    {"case_ID": "45", "function": "修改密码", "testPoint": "点击【取消】按钮取消修改密码返回我的页面"},
    {"case_ID": "46", "function": "修改密码", "testPoint": "点击【提交】按钮依次校验密码、验证码"},
    {"case_ID": "47", "function": "修改密码", "testPoint": "某一项校验出错在对应输入框下方红字提醒"},
    {"case_ID": "48", "function": "修改密码", "testPoint": "全部校验通过提示重置密码成功"}
]

generator_result = [
    {"case_ID": "1", "function": "账号登录", "testpoint": "账号输入框显示清空按钮功能", "prerequisite": "打开登录页面",
     "step": "在账号输入框中输入内容", "expected": "账号输入框右侧显示清空按钮"},
    {"case_ID": "2", "function": "账号登录", "testpoint": "密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "打开登录页面", "step": "在密码输入框中输入内容",
     "expected": "密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "3", "function": "账号登录", "testpoint": "验证码为4位随机大写英文字母", "prerequisite": "打开登录页面",
     "step": "查看验证码", "expected": "验证码为4位随机大写英文字母"},
    {"case_ID": "4", "function": "账号登录", "testpoint": "单击验证码展示区域刷新验证码",
     "prerequisite": "打开登录页面", "step": "单击验证码展示区域", "expected": "验证码刷新"},
    {"case_ID": "5", "function": "账号登录", "testpoint": "验证码有效期60秒", "prerequisite": "打开登录页面",
     "step": "等待60秒后查看验证码", "expected": "验证码失效"},
    {"case_ID": "6", "function": "账号登录", "testpoint": "输入框获取焦点提示文字消失且边框变绿",
     "prerequisite": "打开登录页面", "step": "点击账号输入框/密码输入框/验证码输入框",
     "expected": "对应输入框提示文字消失且边框变为绿色"},
    {"case_ID": "7", "function": "账号登录", "testpoint": "输入框失去焦点恢复原状",
     "prerequisite": "打开登录页面且输入框已获取焦点", "step": "点击输入框外任意区域",
     "expected": "输入框提示文字显示且边框恢复原状"},
    {"case_ID": "8", "function": "账号登录", "testpoint": "点击【登录】按钮依次校验账号、密码、验证码",
     "prerequisite": "打开登录页面", "step": "点击【登录】按钮", "expected": "依次校验账号、密码、验证码"},
    {"case_ID": "9", "function": "账号登录", "testpoint": "某一项校验出错在对应输入框下方红字提醒",
     "prerequisite": "打开登录页面且某一项输入错误", "step": "点击【登录】按钮",
     "expected": "对应输入框下方红字提醒错误原因"},
    {"case_ID": "10", "function": "账号登录", "testpoint": "全部校验通过成功登录并进入系统首页",
     "prerequisite": "打开登录页面且账号、密码、验证码输入正确", "step": "点击【登录】按钮",
     "expected": "成功登录并进入系统首页"},
    {"case_ID": "11", "function": "账号登录", "testpoint": "点击【找回密码】按钮跳转至找回密码页面",
     "prerequisite": "打开登录页面", "step": "点击【找回密码】按钮", "expected": "跳转至找回密码页面"},
    {"case_ID": "12", "function": "账号登录", "testpoint": "账号首次成功登录弹窗提示修改初始密码",
     "prerequisite": "账号首次成功登录", "step": "无", "expected": "弹窗提示账号首次登录需修改初始密码"},
    {"case_ID": "13", "function": "账号登录", "testpoint": "点击【确定】按钮跳转至修改初始密码页面",
     "prerequisite": "账号首次成功登录且弹窗提示修改初始密码", "step": "点击【确定】按钮",
     "expected": "跳转至修改初始密码页面"},
    {"case_ID": "14", "function": "账号登录", "testpoint": "初始密码修改后需重新输入账号、密码、验证码登录",
     "prerequisite": "初始密码已修改", "step": "尝试直接进入系统", "expected": "需重新输入账号、密码、验证码登录"},
    {"case_ID": "15", "function": "重置初始密码", "testpoint": "新密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入重置初始密码页面", "step": "在新密码输入框中输入内容",
     "expected": "新密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "16", "function": "重置初始密码", "testpoint": "确认密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入重置初始密码页面", "step": "在确认密码输入框中输入内容",
     "expected": "确认密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "17", "function": "重置初始密码", "testpoint": "点击【获取验证码】按钮发送6位随机数字验证码",
     "prerequisite": "进入重置初始密码页面", "step": "点击【获取验证码】按钮",
     "expected": "向登录账号绑定手机号发送6位随机数字验证码"},
    {"case_ID": "18", "function": "重置初始密码", "testpoint": "验证码已发送后【获取验证码】按钮展示60秒倒计时",
     "prerequisite": "进入重置初始密码页面且已点击【获取验证码】按钮", "step": "查看【获取验证码】按钮",
     "expected": "【获取验证码】按钮展示60秒倒计时"},
    {"case_ID": "19", "function": "重置初始密码", "testpoint": "验证码有效期60秒",
     "prerequisite": "进入重置初始密码页面且已获取验证码", "step": "等待60秒后使用该验证码", "expected": "验证码失效"},
    {"case_ID": "20", "function": "重置初始密码", "testpoint": "输入框获取焦点提示文字消失且输入框边框变绿",
     "prerequisite": "进入重置初始密码页面", "step": "点击新密码输入框/确认密码输入框/验证码输入框",
     "expected": "对应输入框提示文字消失且边框变为绿色"},
    {"case_ID": "21", "function": "重置初始密码", "testpoint": "输入框失去焦点恢复原状",
     "prerequisite": "进入重置初始密码页面且输入框已获取焦点", "step": "点击输入框外任意区域",
     "expected": "输入框提示文字显示且边框恢复原状"},
    {"case_ID": "22", "function": "重置初始密码", "testpoint": "点击【取消】按钮取消修改初始密码返回登录页面",
     "prerequisite": "进入重置初始密码页面", "step": "点击【取消】按钮", "expected": "取消修改初始密码，返回登录页面"},
    {"case_ID": "23", "function": "重置初始密码", "testpoint": "点击【提交】按钮依次校验密码、验证码",
     "prerequisite": "进入重置初始密码页面", "step": "点击【提交】按钮", "expected": "依次校验密码、验证码"},
    {"case_ID": "24", "function": "重置初始密码", "testpoint": "某一项校验出错在对应输入框下方红字提醒",
     "prerequisite": "进入重置初始密码页面且某一项输入错误", "step": "点击【提交】按钮",
     "expected": "对应输入框下方红字提醒错误原因"},
    {"case_ID": "25", "function": "重置初始密码", "testpoint": "全部校验通过提示重置密码成功返回登录页面",
     "prerequisite": "进入重置初始密码页面且密码、验证码输入正确", "step": "点击【提交】按钮",
     "expected": "提示重置密码成功，返回登录页面"},
    {"case_ID": "26", "function": "找回密码", "testpoint": "新密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入找回密码页面", "step": "在新密码输入框中输入内容",
     "expected": "新密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "27", "function": "找回密码", "testpoint": "确认密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入找回密码页面", "step": "在确认密码输入框中输入内容",
     "expected": "确认密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "28", "function": "找回密码", "testpoint": "点击【获取验证码】按钮发送6位随机数字验证码",
     "prerequisite": "进入找回密码页面", "step": "点击【获取验证码】按钮",
     "expected": "向登录账号绑定手机号发送6位随机数字验证码"},
    {"case_ID": "29", "function": "找回密码", "testpoint": "验证码已发送后【获取验证码】按钮展示60秒倒计时",
     "prerequisite": "进入找回密码页面且已点击【获取验证码】按钮", "step": "查看【获取验证码】按钮",
     "expected": "【获取验证码】按钮展示60秒倒计时"},
    {"case_ID": "30", "function": "找回密码", "testpoint": "验证码有效期60秒",
     "prerequisite": "进入找回密码页面且已获取验证码", "step": "等待60秒后使用该验证码", "expected": "验证码失效"},
    {"case_ID": "31", "function": "找回密码", "testpoint": "输入框获取焦点提示文字消失且输入框边框变绿",
     "prerequisite": "进入找回密码页面", "step": "点击新密码输入框/确认密码输入框/验证码输入框",
     "expected": "对应输入框提示文字消失且边框变为绿色"},
    {"case_ID": "32", "function": "找回密码", "testpoint": "输入框失去焦点恢复原状",
     "prerequisite": "进入找回密码页面且输入框已获取焦点", "step": "点击输入框外任意区域",
     "expected": "输入框提示文字显示且边框恢复原状"},
    {"case_ID": "33", "function": "找回密码", "testpoint": "点击【取消】按钮取消修改初始密码返回登录页面",
     "prerequisite": "进入找回密码页面", "step": "点击【取消】按钮", "expected": "取消修改初始密码，返回登录页面"},
    {"case_ID": "34", "function": "找回密码", "testpoint": "点击【提交】按钮依次校验密码、验证码",
     "prerequisite": "进入找回密码页面", "step": "点击【提交】按钮", "expected": "依次校验密码、验证码"},
    {"case_ID": "35", "function": "找回密码", "testpoint": "某一项校验出错在对应输入框下方红字提醒",
     "prerequisite": "进入找回密码页面且某一项输入错误", "step": "点击【提交】按钮",
     "expected": "对应输入框下方红字提醒错误原因"},
    {"case_ID": "36", "function": "找回密码", "testpoint": "全部校验通过提示重置密码成功返回登录页面",
     "prerequisite": "进入找回密码页面且密码、验证码输入正确", "step": "点击【提交】按钮",
     "expected": "提示重置密码成功，返回登录页面"},
    {"case_ID": "37", "function": "修改密码", "testpoint": "原密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入修改密码页面", "step": "在原密码输入框中输入内容",
     "expected": "原密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "38", "function": "修改密码", "testpoint": "新密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入修改密码页面", "step": "在新密码输入框中输入内容",
     "expected": "新密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "39", "function": "修改密码", "testpoint": "确认密码输入框显示明文查看按钮及清空按钮功能",
     "prerequisite": "进入修改密码页面", "step": "在确认密码输入框中输入内容",
     "expected": "确认密码输入框右侧显示明文查看按钮及清空按钮"},
    {"case_ID": "40", "function": "修改密码", "testpoint": "点击【获取验证码】按钮发送6位随机数字验证码",
     "prerequisite": "进入修改密码页面", "step": "点击【获取验证码】按钮",
     "expected": "向登录账号绑定手机号发送6位随机数字验证码"},
    {"case_ID": "41", "function": "修改密码", "testpoint": "验证码已发送后【获取验证码】按钮展示60秒倒计时",
     "prerequisite": "进入修改密码页面且已点击【获取验证码】按钮", "step": "查看【获取验证码】按钮",
     "expected": "【获取验证码】按钮展示60秒倒计时"},
    {"case_ID": "42", "function": "修改密码", "testpoint": "验证码有效期60秒",
     "prerequisite": "进入修改密码页面且已获取验证码", "step": "等待60秒后使用该验证码", "expected": "验证码失效"},
    {"case_ID": "43", "function": "修改密码", "testpoint": "输入框获取焦点提示文字消失且输入框边框变绿",
     "prerequisite": "进入修改密码页面", "step": "点击原密码输入框/新密码输入框/确认密码输入框/验证码输入框",
     "expected": "对应输入框提示文字消失且边框变为绿色"},
    {"case_ID": "44", "function": "修改密码", "testpoint": "输入框失去焦点恢复原状",
     "prerequisite": "进入修改密码页面且输入框已获取焦点", "step": "点击输入框外任意区域",
     "expected": "输入框提示文字显示且边框恢复原状"},
    {"case_ID": "45", "function": "修改密码", "testpoint": "点击【取消】按钮取消修改密码返回我的页面",
     "prerequisite": "进入修改密码页面", "step": "点击【取消】按钮", "expected": "取消修改密码，返回我的页面"},
    {"case_ID": "46", "function": "修改密码", "testpoint": "点击【提交】按钮依次校验密码、验证码",
     "prerequisite": "进入修改密码页面", "step": "点击【提交】按钮", "expected": "依次校验密码、验证码"},
    {"case_ID": "47", "function": "修改密码", "testpoint": "某一项校验出错在对应输入框下方红字提醒",
     "prerequisite": "进入修改密码页面且某一项输入错误", "step": "点击【提交】按钮",
     "expected": "对应输入框下方红字提醒错误原因"},
    {"case_ID": "48", "function": "修改密码", "testpoint": "全部校验通过提示重置密码成功",
     "prerequisite": "进入修改密码页面且密码、验证码输入正确", "step": "点击【提交】按钮", "expected": "提示重置密码成功"}
]

text = """
5.1 功能概述
5.1.1 业务流程图
5.1.2 功能架构
5.2 功能说明
5.2.1 账号登录
5.2.1.1 业务流程
用户打开登录网址进入登录页面；
输入登录账号、密码、验证码进行登录；
5.2.1.2 页面原型
5.2.1.3 逻辑说明
账号输入框：输入账号后显示清空操作按钮，点击清空按钮清空已输入的账号；
密码输入框：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
验证码：验证码为4位随机的大写英文字母，单击验证码展示区域刷新验证码，验证码有效期为60秒；
所有输入框获取焦点时提示文字消失且边框变为绿色，失去焦点时恢复原状；
【登录】按钮：点击【登录】按钮时依次校验登录账号、密码、验证码，若某一项校验出问题则在对应输入框下方红字提醒用户错误原因，全部校验通过则成功登录并进入系统首页；
【找回密码】按钮：点击【找回密码】按钮跳转至找回密码页面；
账号首次成功登录时弹窗提示账号首次登录时需修改初始密码，点击【确定】按钮跳转至修改初始密码页面，初始密码修改后需要重新输入账号、密码、验证码进行登录；
5.2.2 重置初始密码
5.2.2.1 业务流程
用户初次成功登录账号后弹窗提示用户修改初始密码；
点击弹窗的【确定】按钮后页面跳转至重置初始密码页面；
5.2.2.2 页面原型
5.2.2.3 业务逻辑
新密码输入框：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
确认密码：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
验证码：点击【获取验证码】按钮向登录账号绑定手机号发送6位随机数字验证码，验证码已发送后【获取验证码】按钮展示60秒倒计时，倒计时结束后恢复原状，验证码有效期为60秒；
所有输入框获取焦点时提示文字消失且输入框边框变为绿色，失去焦点时恢复原状；
【取消】按钮：点击【取消】按钮取消修改初始密码，返回至登录页面；
【提交】按钮：点击【提交】按钮依次校验密码、验证码，若某一项校验出问题则在对应输入框下方红字提醒用户错误原因，全部校验通过则提示重置密码成功，然后返回至登录页面；
5.2.3 找回密码
5.2.3.1 业务流程
用户打开登录网址进入登录页面；
忘记登录密码后在登录页面页面点击【找回密码】按钮进入找回密码页面；
5.2.3.2 页面原型
5.2.3.3 业务逻辑
新密码输入框：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
确认密码：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
验证码：点击【获取验证码】按钮向登录账号绑定手机号发送6位随机数字验证码，验证码已发送后【获取验证码】按钮展示60秒倒计时，倒计时结束后恢复原状，验证码有效期为60秒；
所有输入框获取焦点时提示文字消失且输入框边框变为绿色，失去焦点时恢复原状；
【取消】按钮：点击【取消】按钮取消修改初始密码，返回至登录页面；
【提交】按钮：点击【提交】按钮依次校验密码、验证码，若某一项校验出问题则在对应输入框下方红字提醒用户错误原因，全部校验通过则提示重置密码成功，然后返回至登录页面；
5.2.4 修改密码
5.2.4.1 业务流程
用户成功登录账号；
在我的页面选择修改密码进入修改密码页面；
5.2.4.2 页面原型
5.2.4.3 业务逻辑
原密码输入框：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
新密码输入框：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
确认密码：输入密码后显示密码明文查看按钮及清空按钮，鼠标按下明文查看按钮密码明文展示，鼠标松开后密文展示，点击清空按钮清空已输入密码；
验证码：点击【获取验证码】按钮向登录账号绑定手机号发送6位随机数字验证码，验证码已发送后【获取验证码】按钮展示60秒倒计时，倒计时结束后恢复原状，验证码有效期为60秒；
所有输入框获取焦点时提示文字消失且输入框边框变为绿色，失去焦点时恢复原状；
【取消】按钮：点击【取消】按钮取消修改密码，返回至我的页面；
【提交】按钮：点击【提交】按钮依次校验密码、验证码，若某一项校验出问题则在对应输入框下方红字提醒用户错误原因，全部校验通过则提示重置密码成功；
"""

sta = state.TestCaseGenerationState(prd_content=text, detected_testPoint=detector_result,
                                    generated_cases=generator_result, total_evaluation_report={},
                                    single_evaluation_report=[], vectorstore=None)
llm, embeddings = initialize_llm("Volcengine", "doubao-Seed-1.6-thinking", "doubao-embedding")
evaluator.single_evaluator_agent_node(sta, llm, embeddings)
evaluator.total_evaluator_agent_node(sta, llm)
