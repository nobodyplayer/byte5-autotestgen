# 飞书文档测试完整指南

本指南将帮助您创建测试文档并验证飞书集成功能。

## 🎯 测试目标

验证系统能够：
1. 正确读取飞书文档内容
2. 基于PRD内容生成测试用例
3. 处理不同格式的飞书文档链接

## 📋 准备工作

### 1. 环境配置检查

确保您的 `.env` 文件包含以下配置：
```env
FEISHU_APP_ID=your_app_id_here
FEISHU_APP_SECRET=your_app_secret_here
```

### 2. 运行准备脚本

```bash
cd backend
python create_test_document.py
```

这个脚本会：
- 检查您的飞书配置
- 提供详细的文档创建指南
- 生成示例PRD内容文件

## 📝 创建测试文档

### 步骤1：打开飞书

1. 登录飞书客户端或访问 [飞书网页版](https://www.feishu.cn/)
2. 确保您在正确的组织/团队中

### 步骤2：创建新文档

1. 点击 **新建** → **文档**
2. 选择 **新版文档**（推荐）
3. 为文档命名，例如："测试PRD文档 - 用户登录功能"

### 步骤3：添加PRD内容

选择以下示例内容之一：

#### 选项A：用户登录功能PRD
- 复制 `sample_login_prd.md` 文件内容
- 包含完整的登录功能需求和测试要点

#### 选项B：电商购物车功能PRD
- 复制 `sample_ecommerce_prd.md` 文件内容
- 包含购物车功能的详细需求

#### 自定义内容
您也可以使用自己的PRD内容，建议包含：
- 功能概述
- 详细需求
- 异常处理
- 测试要点

### 步骤4：设置文档权限

1. 点击文档右上角的 **分享** 按钮
2. 设置权限为以下之一：
   - **组织内可查看**（推荐）
   - **任何人可查看**
3. 确保 **允许复制和下载** 已开启
4. 点击 **复制链接**

### 步骤5：验证链接格式

确保获取的链接格式正确：

**新版文档链接示例：**
```
https://your-domain.feishu.cn/docx/ABC123DEF456
```

**旧版文档链接示例：**
```
https://your-domain.feishu.cn/doc/doccnXXXXXX
```

## 🧪 测试验证

### 测试1：快速配置验证

```bash
python quick_test.py
```

**预期输出：**
```
✅ 飞书应用配置检查通过
✅ 成功获取访问令牌
✅ 飞书服务初始化成功
```

### 测试2：文档访问验证

```bash
python verify_feishu.py
```

按提示输入您的文档链接，**预期输出：**
```
✅ URL解析成功
✅ 文档访问权限验证通过
✅ 成功获取文档内容
文档内容预览：
# 用户登录功能产品需求文档 (PRD)
...
```

### 测试3：API集成验证

```bash
python test_api_demo.py
```

按提示输入文档链接，**预期输出：**
```
✅ 服务器连接成功
✅ 飞书API调用成功
生成的测试用例：
1. 测试用例标题: 用户正常登录流程验证
   描述: 验证用户使用正确的用户名和密码能够成功登录系统
   ...
```

## 🔧 故障排除

### 常见问题1：权限被拒绝

**错误信息：**
```
❌ 权限验证失败: 403 Forbidden
```

**解决方案：**
1. 检查文档分享权限设置
2. 确认飞书应用有文档读取权限
3. 验证App ID和App Secret是否正确
4. 确保应用在正确的组织下

### 常见问题2：文档链接无效

**错误信息：**
```
❌ URL解析失败: 无效的飞书文档链接
```

**解决方案：**
1. 检查链接格式是否正确
2. 确认链接是完整的分享链接
3. 尝试在浏览器中打开链接验证可访问性

### 常见问题3：内容获取失败

**错误信息：**
```
❌ 获取文档内容失败: 文档不存在或无权限访问
```

**解决方案：**
1. 确认文档未被删除
2. 检查文档权限设置
3. 验证应用权限配置
4. 尝试重新分享文档

## 📊 测试结果验证

### 成功标准

1. **配置验证通过**
   - 能够获取访问令牌
   - 飞书服务初始化成功

2. **文档访问成功**
   - URL解析正确
   - 权限验证通过
   - 能够获取文档内容

3. **测试用例生成**
   - API调用成功
   - 生成合理的测试用例
   - 测试用例包含标题、描述、步骤等

### 质量检查

生成的测试用例应该：
- 覆盖PRD中的主要功能点
- 包含正常流程和异常处理
- 具有清晰的测试步骤
- 包含预期结果

## 🚀 下一步

测试成功后，您可以：

1. **使用Web界面**
   - 启动后端服务：`python main.py`
   - 启动前端服务：`npm start`
   - 在界面中输入飞书文档链接

2. **集成到工作流**
   - 将真实的PRD文档链接用于生成测试用例
   - 导出测试用例到Excel
   - 与团队分享测试结果

3. **扩展功能**
   - 支持更多文档格式
   - 自定义测试用例模板
   - 集成到CI/CD流程

## 📞 技术支持

如果遇到问题：

1. 检查 `FEISHU_SETUP.md` 中的详细配置说明
2. 查看 `TEST_SCRIPTS_README.md` 中的脚本使用指南
3. 确保所有依赖包已正确安装：`pip install -r requirements.txt`

---

**祝您测试顺利！** 🎉