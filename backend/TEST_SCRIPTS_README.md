# 飞书集成验证脚本使用指南

本目录包含了多个验证脚本，用于测试飞书集成功能是否正常工作。

## 📋 脚本说明

### 1. `quick_test.py` - 快速配置验证
**用途**: 快速检查飞书应用配置是否正确
**适用场景**: 刚配置完飞书应用，想快速验证配置是否正确

```bash
cd backend
python quick_test.py
```

**检查内容**:
- ✅ 环境变量配置
- ✅ 飞书应用连接
- ✅ 访问令牌获取

### 2. `verify_feishu.py` - 完整功能验证
**用途**: 全面测试飞书集成的各项功能
**适用场景**: 需要详细验证所有飞书相关功能

```bash
cd backend
python verify_feishu.py
```

**检查内容**:
- ✅ 环境变量配置
- ✅ 飞书服务初始化
- ✅ 访问令牌获取
- ✅ URL解析功能
- ✅ AI服务集成
- 📄 文档访问测试（可选）

### 3. `test_api_demo.py` - API调用演示
**用途**: 演示完整的API调用流程
**适用场景**: 测试服务器运行状态和API功能

```bash
# 先启动服务器
python main.py

# 然后在另一个终端运行测试
python test_api_demo.py
```

**测试内容**:
- 🔍 服务器连接测试
- 📝 文本输入API测试
- 📄 飞书文档API测试
- 📊 流式响应处理

## 🚀 使用步骤

### 步骤1: 环境准备
```bash
# 1. 安装依赖
cd backend
pip install -r requirements.txt

# 2. 配置环境变量
cp .env.example .env
# 编辑 .env 文件，填入你的飞书应用凭证
```

### 步骤2: 快速验证
```bash
# 快速检查配置
python quick_test.py
```

### 步骤3: 完整验证
```bash
# 详细功能测试
python verify_feishu.py
```

### 步骤4: API测试
```bash
# 启动服务器
python main.py

# 新开终端，测试API
python test_api_demo.py
```

## 📊 预期输出示例

### 成功的快速验证输出:
```
🚀 飞书配置快速验证
------------------------------
✅ App ID: cli_a1b2c3d4...
✅ App Secret: abcd1234...
✅ 连接成功！Token: t-g104b7c9c9c9c9c9...

🎉 飞书配置验证通过！

📝 现在可以使用以下方式测试:
1. 启动服务: python main.py
2. 使用API调用测试文档获取功能
```

### 成功的API测试输出:
```
🧪 API功能测试演示
==================================================
🔍 测试服务器连接...
✅ 服务器连接正常

📝 测试文本输入功能...
--------------------------------------------------
📤 发送文本请求...
✅ 文本请求成功

📋 生成的测试用例:
============================================================
# 用户登录功能测试用例

## 测试用例1: 正常登录流程
...
```

## ❌ 常见问题排查

### 问题1: 环境变量未配置
```
❌ 环境变量未配置
请检查 .env 文件中的 FEISHU_APP_ID 和 FEISHU_APP_SECRET
```
**解决方案**: 检查 `.env` 文件是否存在且配置正确

### 问题2: 访问令牌获取失败
```
❌ 连接失败: HTTP 401 Unauthorized
```
**解决方案**: 
- 检查 App ID 和 App Secret 是否正确
- 确认飞书应用状态是否正常
- 检查网络连接

### 问题3: 服务器连接失败
```
❌ 无法连接到服务器: Connection refused
```
**解决方案**: 
- 确保服务器已启动: `python main.py`
- 检查端口8000是否被占用
- 确认防火墙设置

### 问题4: 文档访问权限不足
```
❌ 文档访问失败: 权限不足
```
**解决方案**: 
- 检查飞书应用权限配置
- 确认文档共享设置
- 验证文档URL格式

## 🔧 高级配置

### 自定义服务器地址
如果服务器运行在其他地址，可以修改 `test_api_demo.py` 中的 `BASE_URL`:

```python
BASE_URL = "http://your-server:8000"
```

### 添加更多测试用例
可以在 `test_api_demo.py` 中添加更多测试场景:

```python
def test_custom_scenario():
    # 添加自定义测试逻辑
    pass
```

## 📚 相关文档

- [飞书集成配置指南](./FEISHU_SETUP.md)
- [API接口文档](http://localhost:8000/docs) (服务器启动后访问)
- [飞书开放平台文档](https://open.feishu.cn/)

## 🆘 获取帮助

如果遇到问题:
1. 首先运行 `quick_test.py` 检查基础配置
2. 查看控制台错误信息
3. 检查 `.env` 文件配置
4. 确认飞书应用权限设置
5. 查看相关文档或联系技术支持